# 火车订票系统开发文档

## 后端部分

### 源文件

| 文件名 | 说明 |
| ------- | ----- |
| `Bplustree.h` | B+树 |
| `build.bash` | 编译脚本 |
| `exceptions.h` | debug用,用来更好的抛出异常
| `main.cpp` | 主程序,从`stdin`读入命令,输出到`stdout`
| `mystring.h` | 定长`string`类,操作类似`std::string`
| `sort.h` | 快速排序
| `station.h` | 车站类
| `ticket.h` | 车票类,进行订单相关操作
| `timer.h` | debug用,简易计时器
| `train.h` | 火车类,进行车次相关操作
| `user.h` | 用户类,进行用户相关操作
| `vector.hpp` | 不定长数组,操作类似`std::vector`

### 具体说明

####  `Bplustree.h` 
- 声明
```
Bplustree<Key, T> bpt("file")
```
- 接口

| 迭代器相关操作 | 说明 |
|-----------|-----------|
| `operator++` | 前往下一个元素 |
| `operator--` | 前往上一个元素 |
| `operator*` | 返回元素 |
| `operator->` | 返回指针 |
| `bool valid()`| 返回迭代器是否有效 |
| `void save()`| 保存并写入文件 |
| `Key key()` | 返回指向的键值 |
| `T data()` | 返回键值对应数据 |

| 函数名 | 说明 |
| -- | ------------- |
| `Iterator lower_bound(const Key &key)` | 以迭代器形式返回大于等于key的第一个元素 |
| `Iterator search(const Key &key)` | 以迭代器形式返回键值为key的元素 |
| `bool find(const Key &key)` | 返回是否存在键值为key的元素 |
| `void insert(const Key &key, const T& t)` | 插入元素(key,T) |
| `void erase(const Key &key)` | 删除键值为key的元素 |
| `bool empty()` | 返回B+树是否为空 |
| `int size()` | 返回B+树的元素个数 |
| `void clear()` | 清空B+树 |
| `void save()` | 保存并写入文件 |

#### `build.bash` 
- 编译脚本 

#### `exceptions.h` 
- ~~`run_time_error`~~

#### `main.cpp` 
-  主程序,从stdin读入命令,输出到stdout

#### `mystring.h` 
-  定长string类,操作类似`std::string`
- 声明
```
mystring<MAXL> s;
```
- 支持 `<, [], ==, >>, <<, +, substr, c_str, size, length` 等类`std::string`操作
- `bool get()` 使用 `scanf("%s")` 读入

#### `sort.h` 
-  快速排序 ~~并没有用到~~
` sort(T a[], int l, int r)` 对`a[l,r]`排序
` sort(T a[], int l, int r, bool (*cmp)(const T &a, const T& b))` 对`a[l,r]`排序,按cmp函数比较

#### `timer.h` 
-  debug用,简易计时器

#### `ticket.h` 
-  车票类,进行订单相关操作

| 函数名/类名 | 说明 |
| -- | ------------- |
| `query_ticket` |   |
| `query_transfer` |   |
| `buy_ticket` |   |
| `refund_ticket` |   |
| `query_order` |   |
| `struct ticket` |   |
| `class OrderKey` |   |
| `class Order` |   |

#### `train.h` 
-  火车类,进行车次相关操作

| 函数名/类名 | 说明 |
| -- | ------------- |
| `add_train` |   |
| `sale_train` |   |
| `query_train` |   |
| `delete_train` |   |
| `modify_train` |   |
| `struct TrainKey ` |   |
| `struct TrainNode` |   |
| `struct StationKey` |   |
| `struct StationNode` |   |

#### `user.h` 
-  用户类,进行用户相关操作

| 函数名/类名 | 说明 |
| -- | ------------- |
| `Register` |   |
| `login` |   |
| `query_profile` |   |
| `modify_profile` |   |
| `modify_privilege` |   |
| `class User` |   |

#### `vector.hpp` 
-  不定长数组,操作类似std::vector
- 支持`push_back, []`

## 前端部分

### 源文件

### 具体说明
